p8105_hw2_wl3010
================
WL3010
2025-10-01

``` r
# ---- Problem 1 ----

library(tidyverse)

pols = read_csv("data/pols-month.csv") %>%
  separate(mon, into = c("year", "month", "day"), convert = TRUE) %>%
  mutate(
    month = month.name[month],
    president = case_when(
      prez_gop == 1 ~ "gop",
      prez_dem == 1 ~ "dem"
    ),
    president = factor(president, levels = c("dem", "gop"))
  ) %>%
  select(-prez_gop, -prez_dem, -day)

snp = read_csv("data/snp.csv") %>%
  separate(date, into = c("month", "day", "year"), convert = TRUE) %>%
  mutate(month = month.name[month]) %>%
  select(year, month, close) %>%
  arrange(year, month)

unemp = read_csv("data/unemployment.csv") %>%
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemployment"
  ) %>%
  mutate(month = month.name[match(month, month.abb)]) %>%
  rename(year = Year)

merged_df = pols %>%
  left_join(snp, by = c("year", "month")) %>%
  left_join(unemp, by = c("year", "month"))

glimpse(merged_df)
```

    ## Rows: 822
    ## Columns: 11
    ## $ year         <dbl> 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 1947, 194…
    ## $ month        <chr> "January", "February", "March", "April", "May", "June", "…
    ## $ gov_gop      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 22, 22, 2…
    ## $ sen_gop      <dbl> 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 51, 53, 53, 5…
    ## $ rep_gop      <dbl> 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 253, 25…
    ## $ gov_dem      <dbl> 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 2…
    ## $ sen_dem      <dbl> 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 45, 48, 48, 4…
    ## $ rep_dem      <dbl> 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 198, 19…
    ## $ president    <fct> dem, dem, dem, dem, dem, dem, dem, dem, dem, dem, dem, de…
    ## $ close        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
    ## $ unemployment <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 3.4, 3.8,…

``` r
# ---- Problem 2 ----
```

``` r
library(readxl)
library(janitor)
library(dplyr)

trash_file <- "data/202509 Trash Wheel Collection Data.xlsx"

# ---- Mr. Trash Wheel ----
mr_trash <- read_excel(trash_file, sheet = "Mr. Trash Wheel", range = "A2:M586") %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(year),
    sports_balls = if ("sports_balls" %in% names(.)) as.integer(round(sports_balls)) else NA_integer_,
    name = "Mr. Trash Wheel"
  )

prof_trash <- read_excel(trash_file, sheet = "Professor Trash Wheel", range = "A2:M108") %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(year),
    sports_balls = if ("sports_balls" %in% names(.)) as.integer(round(sports_balls)) else NA_integer_,
    name = "Professor Trash Wheel"
  )

gwynnda <- read_excel(trash_file, sheet = "Gwynns Falls Trash Wheel", range = "A2:M145") %>%
  clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(
    year = as.integer(year),
    sports_balls = if ("sports_balls" %in% names(.)) as.integer(round(sports_balls)) else NA_integer_,
    name = "Gwynnda"
  )

trash_wheel <- bind_rows(mr_trash, prof_trash, gwynnda)

n_obs <- nrow(trash_wheel)

prof_total_weight <- prof_trash %>%
  summarize(total_weight = sum(weight_tons, na.rm = TRUE)) %>%
  pull(total_weight)

gwynnda_cigs_june2022 <- gwynnda %>%
  filter(month == "June", year == 2022) %>%
  summarize(total_cigs = sum(cigarette_butts, na.rm = TRUE)) %>%
  pull(total_cigs)

list(
  n_obs = n_obs,
  prof_total_weight = prof_total_weight,
  gwynnda_cigs_june2022 = gwynnda_cigs_june2022
)
```

    ## $n_obs
    ## [1] 833
    ## 
    ## $prof_total_weight
    ## [1] 216.26
    ## 
    ## $gwynnda_cigs_june2022
    ## [1] 18120

``` r
# ---- Problem 3 ----
library(tidyverse)
library(lubridate)
library(janitor)

zori_tidy <- read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") %>%
  pivot_longer(
    cols = matches("^\\d{4}-\\d{2}-\\d{2}$"),   
    names_to = "date",
    values_to = "zori"
  ) %>%
  mutate(
    date = as.Date(date),                       
    zip  = as.character(RegionName)             
  ) %>%
  select(zip, CountyName, date, zori) %>%
  rename(county_name = CountyName)

zips_tidy <- read_csv("data/Zip Codes.csv") %>%
  clean_names() %>%
  rename(
    zip = zip_code,
    county = county,
    neighborhood = neighborhood
  ) %>%
  mutate(
    zip = as.character(zip),
    borough = case_when(
      county == "New York"   ~ "Manhattan",
      county == "Kings"      ~ "Brooklyn",
      county == "Queens"     ~ "Queens",
      county == "Bronx"      ~ "Bronx",
      county == "Richmond"   ~ "Staten Island",
      TRUE ~ county
    )
  )

final_data <- zori_tidy %>%
  left_join(zips_tidy, by = "zip")

n_obs <- nrow(final_data)
n_zip <- n_distinct(final_data$zip)
n_nbh <- n_distinct(final_data$neighborhood)

missing_zips <- setdiff(zips_tidy$zip, zori_tidy$zip)

jan2020 <- final_data %>%
  filter(date == as.Date("2020-01-31")) %>%
  select(zip, zori_2020 = zori, borough, neighborhood)

jan2021 <- final_data %>%
  filter(date == as.Date("2021-01-31")) %>%
  select(zip, zori_2021 = zori)

drop <- jan2020 %>%
  inner_join(jan2021, by = "zip") %>%
  mutate(delta = zori_2021 - zori_2020) %>%
  arrange(delta)

top10_drop <- head(drop, 10)

list(
  total_observations = n_obs,
  n_unique_zip = n_zip,
  n_unique_neighborhood = n_nbh,
  missing_zips = missing_zips,
  top10_drop = top10_drop
)
```

    ## $total_observations
    ## [1] 17516
    ## 
    ## $n_unique_zip
    ## [1] 149
    ## 
    ## $n_unique_neighborhood
    ## [1] 43
    ## 
    ## $missing_zips
    ##   [1] "10464" "10474" "10475" "10499" "10550" "10704" "10705" "10803" "11202"
    ##  [10] "11224" "11239" "11241" "11242" "11243" "11245" "11247" "11251" "11252"
    ##  [19] "11256" "10008" "10020" "10041" "10043" "10045" "10047" "10048" "10055"
    ##  [28] "10072" "10080" "10081" "10082" "10087" "10101" "10102" "10103" "10104"
    ##  [37] "10105" "10106" "10107" "10108" "10109" "10110" "10111" "10112" "10113"
    ##  [46] "10114" "10115" "10116" "10117" "10118" "10119" "10120" "10121" "10122"
    ##  [55] "10123" "10124" "10125" "10126" "10129" "10130" "10131" "10132" "10133"
    ##  [64] "10138" "10149" "10150" "10151" "10152" "10153" "10154" "10155" "10156"
    ##  [73] "10157" "10158" "10159" "10160" "10161" "10163" "10164" "10165" "10166"
    ##  [82] "10167" "10168" "10169" "10170" "10171" "10172" "10173" "10174" "10175"
    ##  [91] "10176" "10177" "10178" "10179" "10185" "10197" "10199" "10213" "10242"
    ## [100] "10249" "10256" "10259" "10260" "10261" "10265" "10268" "10269" "10270"
    ## [109] "10271" "10272" "10273" "10274" "10275" "10276" "10277" "10278" "10279"
    ## [118] "10281" "10285" "10286" "10292" "11001" "11004" "11005" "11040" "11096"
    ## [127] "11351" "11352" "11359" "11362" "11363" "11371" "11380" "11381" "11386"
    ## [136] "11405" "11411" "11412" "11413" "11414" "11416" "11417" "11419" "11420"
    ## [145] "11421" "11422" "11423" "11424" "11425" "11427" "11428" "11429" "11430"
    ## [154] "11431" "11433" "11436" "11439" "11451" "11499" "11559" "11580" "11690"
    ## [163] "11694" "11695" "11697" "10302" "10307" "10309" "10310" "10311" "10313"
    ## 
    ## $top10_drop
    ## # A tibble: 10 × 6
    ##    zip   zori_2020 borough   neighborhood                  zori_2021 delta
    ##    <chr>     <dbl> <chr>     <chr>                             <dbl> <dbl>
    ##  1 10007     6334. Manhattan Lower Manhattan                   5422. -913.
    ##  2 10069     4623. Manhattan <NA>                              3875. -748.
    ##  3 10009     3406. Manhattan Lower East Side                   2692. -714.
    ##  4 10016     3731. Manhattan Gramercy Park and Murray Hill     3019. -712.
    ##  5 10001     4108. Manhattan Chelsea and Clinton               3398. -710.
    ##  6 10002     3645. Manhattan Lower East Side                   2935. -710.
    ##  7 10004     3150. Manhattan Lower Manhattan                   2444. -706.
    ##  8 10038     3573. Manhattan Lower Manhattan                   2876. -698.
    ##  9 10012     3629. Manhattan Greenwich Village and Soho        2942. -686.
    ## 10 10010     3697. Manhattan Gramercy Park and Murray Hill     3012. -685.

``` r
knitr::kable(top10_drop, caption = "Top 10 ZIPs with largest rent drop Jan2020→Jan2021")
```

| zip   | zori_2020 | borough   | neighborhood                  | zori_2021 |     delta |
|:------|----------:|:----------|:------------------------------|----------:|----------:|
| 10007 |  6334.211 | Manhattan | Lower Manhattan               |  5421.614 | -912.5966 |
| 10069 |  4623.042 | Manhattan | NA                            |  3874.918 | -748.1245 |
| 10009 |  3406.442 | Manhattan | Lower East Side               |  2692.187 | -714.2550 |
| 10016 |  3731.135 | Manhattan | Gramercy Park and Murray Hill |  3019.431 | -711.7045 |
| 10001 |  4108.098 | Manhattan | Chelsea and Clinton           |  3397.648 | -710.4499 |
| 10002 |  3645.416 | Manhattan | Lower East Side               |  2935.113 | -710.3028 |
| 10004 |  3149.658 | Manhattan | Lower Manhattan               |  2443.697 | -705.9608 |
| 10038 |  3573.201 | Manhattan | Lower Manhattan               |  2875.616 | -697.5853 |
| 10012 |  3628.566 | Manhattan | Greenwich Village and Soho    |  2942.344 | -686.2218 |
| 10010 |  3697.284 | Manhattan | Gramercy Park and Murray Hill |  3012.353 | -684.9304 |

Top 10 ZIPs with largest rent drop Jan2020→Jan2021
